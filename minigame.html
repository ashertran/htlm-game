<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Trò chơi di chuyển đến kho báu</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    #container { display: inline-block; position: relative; }
    #grid { display: grid; grid-template-columns: repeat(5, 80px); grid-template-rows: repeat(5, 80px); margin: 20px auto; width: 400px; height: 400px; }
    .cell { border: 2px solid #d0d0d0; display: flex; align-items: center; justify-content: center; font-size: 22px; background: linear-gradient(180deg,#fff,#f7f7ff); }
    .cell[data-hint] { background: #fff8e1; }

    #player { width: 64px; height: 64px; background: lightblue; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 28px; position: absolute; transition: left 0.2s, top 0.2s; pointer-events: none; }

    #controls { margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 12px; }
    .btn { width: 60px; height: 60px; border-radius: 8px; border: none; font-size: 28px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    .btn:active { transform: translateY(2px); }

    #dpad { display: grid; grid-template-columns: repeat(3, 70px); gap: 6px; }
    .spacer { visibility: hidden; }

    #message { margin-top: 12px; font-size: 20px; font-weight: bold; }
    #score { margin-top: 6px; font-size: 16px; }

    /* Friendly colors for lớp 1 */
    .btn-arrow { background: #ffe082; }
    .btn-reset { background: #90caf9; }

    @media (max-width: 480px) {
      #grid { width: 320px; height: 320px; grid-template-columns: repeat(5, 64px); grid-template-rows: repeat(5, 64px); }
      .btn { width: 52px; height: 52px; }
    }
  </style>
</head>
<body>
  <h1>🚁 Trò chơi di chuyển đến kho báu</h1>
  <p>Hướng dẫn: Nhấn mũi tên bên dưới hoặc phím <strong>← ↑ ↓ →</strong> để di chuyển nhân vật đến kho báu <strong>⭐</strong>. Hoặc chạm vào ô muốn đi.</p>

  <div id="container">
    <div id="grid"></div>
    <div id="player">🚁</div>
  </div>

  <div id="controls">
    <div id="dpad">
      <div class="spacer"></div>
      <button class="btn btn-arrow" id="up">↑</button>
      <div class="spacer"></div>

      <button class="btn btn-arrow" id="left">←</button>
      <div class="spacer"></div>
      <button class="btn btn-arrow" id="right">→</button>

      <div class="spacer"></div>
      <button class="btn btn-arrow" id="down">↓</button>
      <div class="spacer"></div>
    </div>
  </div>

  <div style="margin-top:10px">
    <button class="btn btn-reset" id="reset">Bắt đầu</button>
  </div>

  <div id="message"></div>
  <div id="score">Kho báu đã tìm: 0</div>

  <script>
    const grid = document.getElementById('grid');
    const player = document.getElementById('player');
    const message = document.getElementById('message');
    const scoreEl = document.getElementById('score');
    const size = 5; // 5x5

    // Tạo các ô và đánh nhãn ban đầu
    for (let row = 0; row < size; row++) {
      for (let col = 0; col < size; col++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.x = col;
        cell.dataset.y = row;
        cell.innerHTML = `<div style="font-size:14px;color:#666">R${row+1} C${col+1}</div>`;
        cell.addEventListener('click', () => moveTo(col, row));
        grid.appendChild(cell);
      }
    }

    // Player ban đầu (0,0)
    let playerPos = { x: 0, y: 0 };
    let treasure = null;
    let score = 0;

    function placeInitialLabels() {
      const cells = grid.querySelectorAll('.cell');
      cells.forEach((cell, i) => {
        const r = Math.floor(i / size) + 1;
        const c = i % size + 1;
        const d = cell.querySelector('div');
        if (d) d.textContent = `R${r} C${c}`;
        delete cell.dataset.hint;
      });
    }

    function pickTreasure() {
      const cells = grid.querySelectorAll('.cell');
      // xóa nếu có ô treasure cũ
      cells.forEach(cell => { if (cell.dataset.hint === 'treasure') { const d = cell.querySelector('div'); if (d) d.textContent = d.dataset.label || d.textContent; delete cell.dataset.hint; } });

      let tx, ty, idx;
      do {
        tx = Math.floor(Math.random() * size);
        ty = Math.floor(Math.random() * size);
        idx = ty * size + tx;
      } while (tx === playerPos.x && ty === playerPos.y); // tránh trùng với vị trí player

      const target = cells[idx];
      if (target) {
        target.dataset.hint = 'treasure';
        const d = target.querySelector('div');
        if (d) d.textContent = '⭐';
      }
      return { x: tx, y: ty };
    }

    function updateScore() {
      scoreEl.textContent = `Kho báu đã tìm: ${score}`;
    }

    function updatePlayer() {
      const sizePx = grid.clientWidth / size;
      player.style.left = playerPos.x * sizePx + 'px';
      player.style.top = playerPos.y * sizePx + 'px';

      if (playerPos.x === treasure.x && playerPos.y === treasure.y) {
        score++;
        updateScore();
        message.textContent = '🎉 Bạn đã tìm thấy kho báu! Kho báu sẽ di chuyển chỗ khác...';
        // Đợi 700ms rồi sinh kho báu mới (không reset vị trí player)
        setTimeout(() => {
          placeInitialLabels();
          treasure = pickTreasure();
          message.textContent = 'Tiếp tục tìm kho báu!';
          updatePlayer();
        }, 700);
      } else {
        message.textContent = `Bạn đang ở: H${playerPos.y+1} C${playerPos.x+1}`;
      }
    }

    function step(dx, dy) {
      if (playerPos.x + dx >= 0 && playerPos.x + dx < size) playerPos.x += dx;
      if (playerPos.y + dy >= 0 && playerPos.y + dy < size) playerPos.y += dy;
      updatePlayer();
    }

    async function moveTo(targetX, targetY) {
      while (playerPos.x !== targetX) {
        playerPos.x += (targetX > playerPos.x) ? 1 : -1;
        updatePlayer();
        await new Promise(r => setTimeout(r, 160));
      }
      while (playerPos.y !== targetY) {
        playerPos.y += (targetY > playerPos.y) ? 1 : -1;
        updatePlayer();
        await new Promise(r => setTimeout(r, 160));
      }
    }

    // Nút on-screen
    document.getElementById('up').addEventListener('click', () => step(0, -1));
    document.getElementById('down').addEventListener('click', () => step(0, 1));
    document.getElementById('left').addEventListener('click', () => step(-1, 0));
    document.getElementById('right').addEventListener('click', () => step(1, 0));

    document.getElementById('reset').addEventListener('click', () => {
      // Reset: vị trí player về (0,0), đặt lại nhãn ban đầu và reset điểm
      playerPos = { x: 0, y: 0 };
      score = 0;
      updateScore();
      placeInitialLabels();
      treasure = pickTreasure();
      updatePlayer();
      message.textContent = 'Bắt đầu lại! Dùng mũi tên hoặc chạm ô để di chuyển.';
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowUp') step(0, -1);
      if (e.key === 'ArrowDown') step(0, 1);
      if (e.key === 'ArrowLeft') step(-1, 0);
      if (e.key === 'ArrowRight') step(1, 0);
    });

    // Khởi tạo trò chơi
    placeInitialLabels();
    treasure = pickTreasure();
    updateScore();
    updatePlayer();

    // Khi thay đổi kích thước cửa sổ => cập nhật vị trí player cho đúng
    window.addEventListener('resize', () => updatePlayer());
  </script>
</body>
</html>
