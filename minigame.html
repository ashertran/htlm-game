<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tr√≤ ch∆°i di chuy·ªÉn ƒë·∫øn kho b√°u</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 12px; }
    #topbar { margin-bottom: 8px; }
    #container { display: inline-block; position: relative; }

    /* L∆∞·ªõi 5x5 */
    #grid { display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr); width: 420px; height: 420px; border-radius: 8px; overflow: hidden; }
    .cell { border: 2px solid #d0d0d0; display: flex; align-items: center; justify-content: center; font-size: 18px; background: linear-gradient(180deg,#fff,#f7f7ff); }
    .cell[data-hint] { background: #fff8e1; }

    /* Nh√¢n v·∫≠t (absolute b√™n trong container) */
    #player { width: 72px; height: 72px; background: #b3e5fc; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 36px; position: absolute; transition: left 0.18s, top 0.18s; pointer-events: none; box-shadow: 0 6px 14px rgba(0,0,0,0.15); }

    /* Controls */
    #controls { margin-top: 12px; display: flex; align-items: center; justify-content: center; gap: 12px; }
    .btn { width: 60px; height: 60px; border-radius: 10px; border: none; font-size: 26px; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.12); }
    .btn:active { transform: translateY(2px); }
    .btn-arrow { background: #ffe082; }
    .btn-reset { background: #90caf9; }

    #dpad { display: grid; grid-template-columns: repeat(3, 70px); gap: 8px; }
    .spacer { visibility: hidden; }

    #message { margin-top: 8px; font-size: 18px; font-weight: 600; }
    #score { margin-top: 4px; font-size: 16px; }

    /* H·ªôp lu·∫≠t ch∆°i c·ªë ƒë·ªãnh */
    #rules { text-align: left; display: inline-block; width: 420px; margin-bottom: 10px; background: #fff8e1; padding: 10px; border-radius: 8px; font-size: 16px; }

    @media (max-width: 480px) {
      #grid { width: 320px; height: 320px; }
      #player { width: 56px; height: 56px; font-size: 26px; }
      .btn { width: 48px; height: 48px; }
      #rules { width: 320px; }
    }
  </style>
</head>
<body>
  <div id="topbar">
    <h1>üöÅ Tr√≤ ch∆°i di chuy·ªÉn ƒë·∫øn kho b√°u</h1>
    <div id="rules">
      <strong>üìú Lu·∫≠t ch∆°i (r·∫•t d·ªÖ):</strong>
      <ol>
        <li>Nh·∫•n n√∫t m≈©i t√™n (ho·∫∑c ph√≠m ‚Üê ‚Üë ‚Üì ‚Üí) ƒë·ªÉ di chuy·ªÉn nh√¢n v·∫≠t.</li>
        <li>T√¨m ng√¥i sao <strong>‚≠ê</strong> ƒë·ªÉ l·∫•y kho b√°u ‚Äî m·ªói l·∫ßn t√¨m ƒë∆∞·ª£c s·∫Ω +1 ƒëi·ªÉm.</li>
        <li>Ng√¥i sao s·∫Ω nh·∫£y sang √¥ kh√°c sau khi b·∫°n ƒë·∫øn n∆°i. C·ªë g·∫Øng t√¨m th·∫≠t nhi·ªÅu nh√©!</li>
      </ol>
    </div>
  </div>

  <div id="container">
    <div id="grid" aria-hidden="false"></div>
    <div id="player" aria-hidden="true">üöÅ</div>
  </div>

  <div id="controls">
    <div id="dpad">
      <div class="spacer"></div>
      <button class="btn btn-arrow" id="up">‚Üë</button>
      <div class="spacer"></div>

      <button class="btn btn-arrow" id="left">‚Üê</button>
      <div class="spacer"></div>
      <button class="btn btn-arrow" id="right">‚Üí</button>

      <div class="spacer"></div>
      <button class="btn btn-arrow" id="down">‚Üì</button>
      <div class="spacer"></div>
    </div>
    <div>
      <button class="btn btn-reset" id="reset">B·∫Øt ƒë·∫ßu</button>
    </div>
  </div>

  <div id="message">B·∫•m n√∫t ho·∫∑c ch·∫°m √¥ ƒë·ªÉ di chuy·ªÉn.</div>
  <div id="score">Kho b√°u ƒë√£ t√¨m: 0</div>

  <script>
  // ƒê√≥ng g√≥i to√†n b·ªô logic sau khi DOM load ƒë·ªÉ tr√°nh l·ªói khi deploy (Github Pages ƒë√¥i khi load kh√°c)
  document.addEventListener('DOMContentLoaded', () => {
    const grid = document.getElementById('grid');
    const player = document.getElementById('player');
    const message = document.getElementById('message');
    const scoreEl = document.getElementById('score');
    const size = 5; // 5x5

    // T·∫°o √¥ grid r√µ r√†ng v√† l∆∞u tham chi·∫øu
    const cells = [];
    function buildGrid() {
      grid.innerHTML = '';
      for (let row = 0; row < size; row++) {
        for (let col = 0; col < size; col++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.dataset.x = col;
          cell.dataset.y = row;
          cell.dataset.index = row * size + col;
          const label = document.createElement('div');
          label.style.fontSize = '14px';
          label.style.color = '#444';
          label.textContent = `R${row+1} C${col+1}`;
          label.dataset.label = label.textContent;
          cell.appendChild(label);

          cell.addEventListener('click', () => moveTo(col, row));
          grid.appendChild(cell);
          cells.push(cell);
        }
      }
    }

    // Tr·∫°ng th√°i game
    let playerPos = { x: 0, y: 0 };
    let treasure = null;
    let score = 0;

    function placeInitialLabels() {
      cells.forEach((cell, i) => {
        const d = cell.querySelector('div');
        if (d) d.textContent = d.dataset.label || d.textContent;
        delete cell.dataset.hint;
      });
    }

    function pickTreasure() {
      // x√≥a treasure c≈©
      cells.forEach(cell => { if (cell.dataset.hint === 'treasure') { const d = cell.querySelector('div'); if (d) d.textContent = d.dataset.label || d.textContent; delete cell.dataset.hint; } });

      let tx, ty, idx;
      do {
        tx = Math.floor(Math.random() * size);
        ty = Math.floor(Math.random() * size);
        idx = ty * size + tx;
      } while (tx === playerPos.x && ty === playerPos.y);

      const target = cells[idx];
      if (target) {
        target.dataset.hint = 'treasure';
        const d = target.querySelector('div');
        if (d) d.textContent = '‚≠ê';
      }
      return { x: tx, y: ty };
    }

    function updateScore() {
      scoreEl.textContent = `Kho b√°u ƒë√£ t√¨m: ${score}`;
    }

    function updatePlayer() {
      // T√≠nh l·∫°i k√≠ch th∆∞·ªõc √¥ m·ªói l·∫ßn (tr√°nh l·ªói width=0 khi ch∆∞a render tr√™n Github Pages)
      const rect = grid.getBoundingClientRect();
      const sizePx = rect.width / size;
      // di chuy·ªÉn player relative ƒë·∫øn container (player l√† con c·ªßa container)
      player.style.left = playerPos.x * sizePx + 'px';
      player.style.top = playerPos.y * sizePx + 'px';

      if (playerPos.x === treasure.x && playerPos.y === treasure.y) {
        score++;
        updateScore();
        message.textContent = 'üéâ B·∫°n ƒë√£ t√¨m th·∫•y kho b√°u! Kho b√°u s·∫Ω di chuy·ªÉn ch·ªó kh√°c...';
        // delay r·ªìi sinh treasure m·ªõi
        setTimeout(() => {
          placeInitialLabels();
          treasure = pickTreasure();
          message.textContent = 'Ti·∫øp t·ª•c t√¨m kho b√°u!';
          updatePlayer();
        }, 700);
      } else {
        message.textContent = `B·∫°n ƒëang ·ªü: H${playerPos.y+1} C${playerPos.x+1}`;
      }
    }

    function step(dx, dy) {
      const nx = playerPos.x + dx;
      const ny = playerPos.y + dy;
      if (nx >= 0 && nx < size) playerPos.x = nx;
      if (ny >= 0 && ny < size) playerPos.y = ny;
      updatePlayer();
    }

    async function moveTo(targetX, targetY) {
      while (playerPos.x !== targetX) {
        playerPos.x += (targetX > playerPos.x) ? 1 : -1;
        updatePlayer();
        await new Promise(r => setTimeout(r, 160));
      }
      while (playerPos.y !== targetY) {
        playerPos.y += (targetY > playerPos.y) ? 1 : -1;
        updatePlayer();
        await new Promise(r => setTimeout(r, 160));
      }
    }

    // Buttons
    document.getElementById('up').addEventListener('click', () => step(0, -1));
    document.getElementById('down').addEventListener('click', () => step(0, 1));
    document.getElementById('left').addEventListener('click', () => step(-1, 0));
    document.getElementById('right').addEventListener('click', () => step(1, 0));
    document.getElementById('reset').addEventListener('click', () => {
      playerPos = { x: 0, y: 0 };
      score = 0;
      updateScore();
      placeInitialLabels();
      treasure = pickTreasure();
      updatePlayer();
      message.textContent = 'B·∫Øt ƒë·∫ßu l·∫°i! D√πng m≈©i t√™n ho·∫∑c ch·∫°m √¥ ƒë·ªÉ di chuy·ªÉn.';
    });

    // Keyboard
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowUp') step(0, -1);
      if (e.key === 'ArrowDown') step(0, 1);
      if (e.key === 'ArrowLeft') step(-1, 0);
      if (e.key === 'ArrowRight') step(1, 0);
    });

    // Build + start
    buildGrid();
    placeInitialLabels();
    treasure = pickTreasure();
    updateScore();
    updatePlayer();

    // Resize listener to keep player positioned correctly
    window.addEventListener('resize', () => updatePlayer());
  });
  </script>
</body>
</html>
